---
- name: Create user
  user:
    name: privileged
    shell: /bin/bash
    groups: sudo
    append: yes

- name: Install firewalld
  apt:
    name: "{{ item }}"
    update_cache: yes
  with_items:
    - htop
    - firewalld

- name: Enable port 80
  firewalld:
    port: 80/tcp
    permanent: true
    state: disabled

- name: Upload file app
  template:
    src: app.py.j2
    dest: /opt/app.py

- name: Copy service
  template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
  with_items:
    - { src: app.service.j2, dest: /lib/systemd/system/app.service }
      #    - { src: app.timer.j2, dest: /lib/systemd/system/app.timer}

- name: Enable app service
  systemd:
    name: app.service
    state: restarted
    enabled: yes
    daemon_reload: yes
